(function(b){b.fn.tinyLightbox=function(c){return this.each(function(){!b.data(this,"tinyLightbox")&&b.data(this,"tinyLightbox",new a(this,c)).init()})};b.fn.tinyLightbox.defaults={item:"a",slideshowSpeed:5000,slideshowAutostart:false,pathAttr:"href",descrAttr:"title",speed:300,labelImage:"Image",labelOf:"of",animation:"original",keyNavigation:true,cycle:false,minWidth:250,minHeight:190,overlayOpacity:0.7,bgiframe:true};function a(k,e){var w='        <div id="tiny-lightbox" class="tiny-lightbox-animating tiny-lightbox-loading">            <div id="tiny-lightbox-overlay" data-action="close"></div>            <div id="tiny-lightbox-box" >                <div id="tiny-lightbox-image"></div>                <a id="tiny-lightbox-prev" data-action="showPrev" hidefocus="hidefocus" href="#">                    <span data-action="showPrev"></span>                </a>                <a id="tiny-lightbox-next" data-action="showNext" hidefocus="hidefocus" href="#">                    <span data-action="showNext"></span>                </a>            </div>            <div id="tiny-lightbox-bar">                <div id="tiny-lightbox-description"></div>                <span id="tiny-lightbox-stats"></span>                <a id="tiny-lightbox-close" title="Close" alt="Close" data-action="close" href="#"></a>                <a id="tiny-lightbox-slideshow" title="Slideshow" alt="Slideshow" data-action="slideshow" href="#"/>            </div>        </div>    ';var p=this,q=b(k),c,m,l,f,v,u,r,d,j;var n=this.s=b.extend({},b.fn.tinyLightbox.defaults,e);this.init=function(){j=n.cycle;u=b.fn.tinyLightbox[n.animation](p);m=b(n.item+"["+n.pathAttr+"]",q);q.bind("click",function(y){var s=b(y.target).closest(n.item);r=m.index(s[0]);if(r==-1){return}if(p.$tl){return false}p.$tl=b(w).appendTo(document.body);p.$overlay=b("#tiny-lightbox-overlay").css("opacity",n.overlayOpacity);o();p.$box=b("#tiny-lightbox-box");p.$image=b("#tiny-lightbox-image");p.path=s.attr(n.pathAttr);p.boxData={width:p.$box.width(),height:p.$box.height(),top:parseInt(p.$box.css("top"))+p.docData.scrollTop,borderWidth:(p.$box.outerWidth()-p.$box.innerWidth())/2||0};h();p.$bar=b("#tiny-lightbox-bar");f=b("#tiny-lightbox-description");l=b("#tiny-lightbox-stats");t();p.$tl.bind("click",function(A){var z=b(A.target).attr("data-action");if(!z){return}p[z]();return false});v=b("#tiny-lightbox-next, #tiny-lightbox-prev").bind("mouseover",function(){b("span",this).addClass("tiny-lightbox-hover")}).bind("mouseout",function(){b("span",this).removeClass("tiny-lightbox-hover")});b(window).bind("resize",o);n.keyNavigation&&b(document).bind("keydown",x);n.bgiframe&&b.fn.bgiframe&&p.$tl.bgiframe();u.start(function(){i(p.path,function(){u.animate(function(){o();p.$tl.removeClass("tiny-lightbox-animating");if(n.slideshowAutostart){d=setTimeout(slideshow,n.slideshowSpeed);p.$bar.addClass("tiny-lightbox-slideshow-running")}})})});return false})};this.showNext=function(){g(r+1)};this.showPrev=function(){g(r-1)};this.slideshow=function(s){if(d&&!s){clearTimeout(d);j=n.cycle;p.$bar.removeClass("tiny-lightbox-slideshow-running");d=false}else{j=true;p.$bar.addClass("tiny-lightbox-slideshow-running");g(r+1,function(){d=setTimeout(function(){p.slideshow(true)},n.slideshowSpeed)})}};this.close=function(){clearTimeout(d);v.unbind("mouseover mouseout");b(window).unbind("resize",o);n.keyNavigation&&b(document).unbind("keydown",x);u.close(function(){p.$tl.unbind("click").remove();delete p.$tl})};function o(){p.docData={width:b(window).width(),height:b(document).height(),scrollTop:b(window).scrollTop(),scrollLeft:b(window).scrollLeft()};p.$tl.add(p.$overlay).css({height:p.docData.height,width:p.docData.width})}function x(s){s.keyCode==39?p.showNext():s.keyCode==37?p.showPrev():s.keyCode==27&&p.close()}function i(y,z){p.$tl.addClass("tiny-lightbox-loading");var s=new Image();s.onload=function(){p.$tl.removeClass("tiny-lightbox-loading");b.extend(p.boxData,{width:s.width>n.minWidth?s.width:n.minWidth,height:s.height>n.minHeight?s.height:n.minHeight});h();z()};s.src=p.path=y}function h(){p.boxData.left=(p.docData.width-(p.boxData.width+p.boxData.borderWidth*2))/2}function t(){l.text(n.labelImage+" "+(r+1)+" "+n.labelOf+" "+m.length);var s=m.eq(r).attr(n.descrAttr);f.html(s)[s?"show":"hide"]()}function g(y,s){if(p.$tl.hasClass("tiny-lightbox-animating")){return}if(y>m.length-1||y<0){if(j){g(y<0?m.length-1:0,s)}else{p.$tl.addClass("tiny-lightbox-animating");u.limit(function(){p.$tl.removeClass("tiny-lightbox-animating")})}return}r=y;p.$tl.addClass("tiny-lightbox-animating");u.prepare(function(){i(m.eq(r).attr(n.pathAttr),function(){t();u.animate(function(){p.$tl.removeClass("tiny-lightbox-animating");o();b(s)})})})}}})(jQuery);